id: 0ad
version: 0.0.26
about: cross-platform, 3D and historically-based real-time strategy game

depends:
  - components/binutils.yml
  - components/libboost.yml
  - components/curl.yml
  - components/enet.yml
  - components/fmt.yml
  - components/gloox.yml
  - components/glu.yml
  - components/icu.yml
  - components/libglvnd.yml
  - components/libogg.yml
  - components/libpng.yml
  - components/libsodium.yml
  - components/libvorbis.yml
  - components/libxml2.yml
  - components/miniupnpc.yml
  - components/nspr.yml
  - components/openal.yml
  - components/sdl2.yml
  - components/wxgtk.yml
  - components/zlib.yml
build-depends:
  - components/boost.yml
  - components/cmake.yml
  - components/mesa.yml
  - components/x11/libsm.yml
  - components/mesa.yml
  - components/python.yml
  - components/rustc.yml
  - components/zip.yml
  - components/appimagetool.yml
sources:
  - https://releases.wildfiregames.com/%{id}-%{version}-unix-build.tar.xz
  - https://releases.wildfiregames.com/0ad-%{version}-unix-data.tar.xz
script: |
  useradd -m build_user
  chown build_user: -Rv .

  cd build/workspaces
  export WX_CONFIG="wx-config-gtk3"

  sudo -u build_user sh ./update-workspaces.sh -j$(nproc) \
    --without-pch \
    --bindir=/usr/bin \
    --libdir=/usr/lib/0ad \
    --datadir=%{datadir}/0ad/data

  VERBOSE=1 make config=release

  install -d %{install-root}/usr/{bin,lib/0ad,share/0ad/data}
  install -D -m 0755 binaries/system/pyrogenesis %{install-root}/usr/bin/
  install -D -m 0755 binaries/system/*.so %{install-root}/usr/lib/0ad/
  cp -r binaries/data/l10n/ %{install-root}%{datadir}/0ad/data/

  install -Dm0755 build/resources/0ad.sh %{install-root}/usr/bin/0ad
  cp build/resources/0ad.desktop %{install-root}/
  cp build/resources/0ad.png %{install-root}/
  cp /files/AppRun %{install-root}/
  chmod +x %{install-root}/AppRun

  mkdir -p %{install-root}%{datadir}/%{id}
  tar -xaf ${PKGUPD_SRCDIR}/%{id}-%{version}-unix-data.tar.xz
  cp -r %{id}-%{version}/binaries/data %{install-root}%{datadir}/%{id}/
