id: nautilus
version: 40.2
about: Package contains the GNOME file manager
type: app
category: accessories
tags:
  - file-manager
bundle: true
depends:
  buildtime:
    - bubblewrap
    - gexiv2
    - gnome-autoar
    - gnome-desktop
    - libhandy
    - libnotify
    - libseccomp
    - tracker-miners
    - desktop-file-utils
    - exempi
    - gst-plugins-base
    - libexif
    - libportal
    - gd
    - adwaita-icon-theme
    - gvfs
    - gobject-introspection
    - appimagetool

sources:
  - https://download.gnome.org/sources/nautilus/40/nautilus-{{version}}.tar.xz

configure: >
  -D docs=false
  -D packagekit=false

pre-script: |
  sed '33d' -i data/meson.build
  sed '46d' -i data/meson.build
  sed '59d' -i data/meson.build
  cat data/meson.build
post-script: |
  cd ${pkgupd_pkgdir}

  rm -r usr/lib/{pkgconfig,girepository-1.0}
  rm -r usr/include/

  glib-compile-schemas usr/share/glib-2.0/schemas/
  cp usr/share/icons/hicolor/scalable/apps/org.gnome.Nautilus.svg {{id}}.png
  cp usr/share/applications/org.gnome.Nautilus.desktop {{id}}.desktop
  sed -i 's#org.gnome.Nautilus#{{id}}#' {{id}}.desktop

  install -v -m 0755 ${FILES_DIR}/AppRun AppRun
  sed -i '/^DBusActivatable/d' {{id}}.desktop