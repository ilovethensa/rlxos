no-strip: true

variables:
  include-root: "/sysroot/"
  apps-dir: "apps"
  include-depends: false
  force-rebuild: true

build-depends:
  - components/swupd.yml

script: |
  for appImage in /sysroot/*.app ; do
    swupd app integrate $appImage -install-path /apps/
  done
  mkdir -p %{install-root}%{datadir}/factory/
  mv /apps %{install-root}%{datadir}/factory/

  install -vDm0644 /dev/stdin %{install-root}/%{libdir}/systemd/system/install-apps.service << "EOF"
  [Unit]
  Description=Install Builtin Apps
  ConditionPathNotExists=/apps

  [Service]
  Type=oneshot
  ExecStart=%{bindir}/cp -rap %{datadir}/factory/apps /

  [Install]
  WantedBy=multi-user.target
  EOF
