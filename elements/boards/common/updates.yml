merge: [version.yml]
no-strip: true

variables:
  include-root: /sysroot

depends:
  - components/zsync.yml

sources:
  - files/changelog

script: |
  mkdir -p %{install-root} && cd %{install-root}
  mv /sysroot/%{id}-image rlxos-%{id}-%{version}.img
  sha256sum rlxos-%{id}-%{version}.img > rlxos-%{id}-%{version}.img.sha256sum
  zsyncmake -u %{server}/rlxos-%{id}-%{version}.img rlxos-%{id}-%{version}.img
  changelog="$(cat %{build-root}/changelog | tr '\n' '%')"
  cat >%{codename}<<EOF
  {
    "updates": [
      {
        "url": "%{server}/rlxos-%{id}-%{version}.img",
        "changelog": "${changelog}",
        "version": %{version}
      }
    ]
  }
  EOF
