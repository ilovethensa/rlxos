merge: [version.yml]
no-strip: true
build-type: system

variables:
  root-password: rlxos

script: |
  if [ -d %{localstatedir}/lib/integrations ] ; then
    for i in %{localstatedir}/lib/integrations/* ; do
      echo "=> integrating $(basename $i)"
      sh -e $i
    done
  fi

  systemd-sysusers
  systemd-tmpfiles --create || true
  systemctl preset-all || true
  systemctl --global preset-all || true

  # TODO: NEEDED?
  pwconv
  grpconv

  echo -e "%{root-password}\n%{root-password}" | passwd
  ln -sv %{datadir}/zoneinfo/Asia/Kolkata %{sysconfdir}/localtime

  echo "LABEL=RLXOS / iso9660 errors=remount-ro,relatime 0 1" >/etc/fstab

  echo -n "%{version}" > /usr/.version

build-time:
  - components/core/grub.yml
  - components/core/squashfs-tools.yml
  - components/core/linux.yml
  - components/core/systemd.yml

include:
  - components/core.yml
  - components/core/swupd.yml
  - components/core/layers.yml
  - components/core/vim.yml

  - components/core/tzdata.yml
  - components/core/strace.yml
  - components/core/grub.yml
  - components/core/mkinitramfs.yml
  - components/core/squashfs-tools.yml
  - components/core/e2fsprogs.yml
  - components/core/linux.yml
  
  - components/wlroots.yml

  # Fonts
  - components/fonts/cantarell.yml

  # Apps
  - apps/foot.yml
