id: qt5-webengine
version: 5.15.10
about: QtWebEngine integrates chromium's web capabilities into Qt
release: 0
depends:
- components/nodejs.yml
- components/nss.yml
- components/pciutils.yml
- components/qt.yml
- components/alsa-lib.yml
- components/pulseaudio.yml
- components/ffmpeg.yml
- components/icu.yml
- components/libwebp.yml
- components/libxslt.yml
- components/opus.yml
- components/libevent.yml
- components/krb5.yml
- components/pipewire.yml
- components/poppler.yml
build-time:
- components/gperf.yml
sources:
- https://anduin.linuxfromscratch.org/BLFS/qtwebengine/qtwebengine-%{version}.tar.xz
script: |
  patch -Np1 -i /files/qtwebengine-5.15.10-build_fixes-1.patch
  mkdir -pv .git src/3rdparty/chromium/.git
  sed -e '/^MODULE_VERSION/s/5.*/5.15.5/' -i .qmake.conf
  find -type f -name "*.pr[io]" |
    xargs sed -i -e 's|INCLUDEPATH += |&$$QTWEBENGINE_ROOT/include |'

  sed -e '/link_pulseaudio/s/false/true/' \
    -i src/3rdparty/chromium/media/media_options.gni

  sed -i 's/NINJAJOBS/NINJA_JOBS/' src/core/gn_run.pro

  mkdir -p build && cd build
  qmake .. -- -system-ffmpeg -webengine-icu

  make
  make INSTALL_ROOT=%{install-root} install

  find %{install-root}/ -name \*.prl \
   -exec sed -i -e '/^QMAKE_PRL_BUILD_DIR/d' {} \;

