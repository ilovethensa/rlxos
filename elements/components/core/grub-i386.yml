id: grub-i386
version: 2.06
release: 1
about: GRand Unified Bootloader

environ:
  - PYTHON=python3

sources:
  - http://ftp.gnu.org/gnu/grub/grub-%{version}.tar.xz
  - patches/core/grub/grub-2.06-upstream_fixes-1.patch

build-type: autotools

pre-script: |
  patch -Np1 -i %{build-root}/grub-2.06-upstream_fixes-1.patch

configure: >
  --disable-werror
  --disable-efiemu
  --with-platform=pc
  --target=i386
  --disable-nls
  --sysconfdir=/etc
  CFLAGS="-Os"
  CXXFLAGS="${CFLAGS}"

post-script: |
  rm -rf %{install-root}/etc %{install-root}/usr/bin %{install-root}/usr/sbin
  rm -rf %{install-root}/usr/share/grub/grub-mkconfig_lib
  rm -rf %{install-root}/usr/share/info

depends:
  - components/core/gettext.yml
  - components/core/bash.yml
  - components/core/xz.yml
  - components/core/freetype.yml
  - components/core/libisoburn.yml
  - components/core/dosfstools.yml

build-time:
  - components/core/python.yml
  - components/core/flex.yml
  - components/core/m4.yml
  - components/core/bison.yml
