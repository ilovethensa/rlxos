id: dbus
version: 1.14.8
about: A message bus system, a simple way for applications to talk to one another
sources:
  - https://dbus.freedesktop.org/releases/dbus/dbus-%{version}.tar.xz

build-time:
  - components/core/python.yml
depends:
  - components/core/expat.yml
  - components/elogind.yml

build-type: autotools

variables:
  run-autogen: false

configure: >-
  --disable-static 
  --disable-doxygen-docs 
  --disable-xml-docs
  --with-console-auth-dir=/run/console 
  --with-system-pid-file=/run/dbus/pid 
  --with-system-socket=/run/dbus/system_bus_socket
  --libexecdir=/usr/lib/dbus-1.0 
  --localstatedir=/var 
  --with-systemduserunitdir=no
  --with-systemdsystemunitdir=no
  --without-x runstatedir=/run

post-script: |
  chown -v root:messagebus %{install-root}/%{libdir}/dbus-1.0/dbus-daemon-launch-helper
  chmod -v 4750            %{install-root}/%{libdir}/dbus-1.0/dbus-daemon-launch-helper

  rm -rf %{install-root}/%{localstatedir}/run

  ln -sfv %{localstatedir}/lib/dbus/machine-id %{install-root}/%{sysconfdir}/
  install -vDm0754 /files/dbus/service %{install-root}/%{sysconfdir}/rc.d/init.d/dbus

integration: |
  mkdir -p %{sysconfdir}/rc.d/rc{0..6}.d/
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc0.d/K30dbus
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc1.d/K30dbus
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc2.d/S29dbus
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc3.d/S29dbus
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc4.d/S29dbus
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc5.d/S29dbus
  ln -sf  ../init.d/dbus %{sysconfdir}/rc.d/rc6.d/K30dbus
