id: apache
version: 2.4.53
about: |
  Apache HTTP server version 2.4.x
depends:
  runtime:
    - apr
    - apr-utils
    - pcre
    - openssl
    - libxml2
sources:
  - https://downloads.apache.org/httpd/httpd-{{version}}.tar.gz

groups:
  - id: 25
    name: apache
users:
  - id: 25
    name: apache
    about: Apache Server
    group: apache
    dir: /srv/www
    shell: /bin/false

build-dir: httpd-{{version}}
pre-script: |
  patch -Np1 -i ${FILES}/apache/layout-{{version}}.patch
  sed '/dir.*CFG_PREFIX/s@^@#@' -i support/apxs.in

build-type: autoconf
configure: >
  --enable-authz-fcgi
  --enable-layout=RLXOS
  --enable-mods-shared="all cgi"
  --enable-mpms-shared=all
  --enable-suexec=shared
  --with-apr=/usr/bin/apr-1-config
  --with-apr-util=/usr/bin/apu-1-config
  --with-suexec-bin=/usr/lib/httpd/suexec
  --with-suexec-caller=apache
  --with-suexec-docroot=/srv/www
  --with-suexec-logfile=/var/log/httpd/suexec.log
  --with-suexec-uidmin=100
  --with-suexec-userdir=public_html

post-script: |
  install -v -d -m 0755 ${pkgupd_pkgdir}/run/httpd
  # mv -v ${pkgupd_pkgdir}/usr/bin/suexec ${pkgupd_pkgdir}/usr/lib/httpd/suexec
  # chgrp 25 ${pkgupd_pkgdir}/usr/lib/httpd/suexec
  # chmod 4754 ${pkgupd_pkgdir}/usr/lib/httpd/suexec
  install -v -d -m 0755 -o 25 -g 25 ${pkgupd_pkgdir}/srv/www
  install -v -D -m 0644 ${FILES}/apache/service ${pkgupd_pkgdir}/usr/lib/systemd/system/httpd.service
      