From f3980df66f712dc0c44f1bf88ba06e3865799b56 Mon Sep 17 00:00:00 2001
From: itsmanjeet <itsmanjeet1998@gmail.com>
Date: Tue, 5 Oct 2021 23:37:06 +0530
Subject: [PATCH] fixed compiler

---
 libpkgupd/compiler.cc | 31 ++++++++++++++++++++++++++++---
 libpkgupd/compiler.hh |  1 -
 2 files changed, 28 insertions(+), 4 deletions(-)

diff --git a/libpkgupd/compiler.cc b/libpkgupd/compiler.cc
index 5e30e01..fc41d24 100644
--- a/libpkgupd/compiler.cc
+++ b/libpkgupd/compiler.cc
@@ -83,15 +83,40 @@ bool compiler::compile(std::string const &srcdir, std::string const &destdir) {
 
     switch (config) {
         case configurator::AUTOCONF:
-            cmd = srcdir + "/configure " + getargs("configure", "--prefix=/usr");
+            cmd = srcdir + "/configure " + getargs("configure",
+                                                   " --prefix=/usr "
+                                                   " --sysconfdir=/etc"
+                                                   " --libdir=/usr/lib"
+                                                   " --libexecdir=/usr/lib"
+                                                   " --bindir=/usr/bin"
+                                                   " --sbindir=/usr/bin"
+                                                   " --localstatedir=/var"
+                                                   " --datadir=/usr/share");
             break;
 
         case configurator::MESON:
-            cmd = "meson " + getargs("configure", "--prefix=/usr");
+            cmd = "meson " + getargs("configure",
+                                     "--prefix=/usr "
+                                     " --sysconfdir=/etc"
+                                     " --libdir=/usr/lib"
+                                     " --libexecdir=/usr/lib"
+                                     " --bindir=/usr/bin"
+                                     " --sbindir=/usr/bin"
+                                     " --localstatedir=/var"
+                                     " --datadir=/usr/share") +
+                  " " + builddir;
             break;
 
         case configurator::CMAKE:
-            cmd = "cmake -S " + srcdir + " " + getargs("configure", "-DCMAKE_INSTALL_PREFIX=/usr");
+            cmd = "cmake -S " + srcdir + " -B " + builddir + " " + getargs("configure",
+                                                                           "-DCMAKE_INSTALL_PREFIX=/usr "
+                                                                           " -DCMAKE_INSTALL_SYSCONFDIR=/etc"
+                                                                           " -DCMAKE_INSTALL_LIBDIR=/usr/lib"
+                                                                           " -DCMAKE_INSTALL_LIBEXECDIR=/usr/lib"
+                                                                           " -DCMAKE_INSTALL_BINDIR=/usr/bin"
+                                                                           " -DCMAKE_INSTALL_SBINDIR=/usr/bin"
+                                                                           " -DCMAKE_INSTALL_DATADIR=/usr/share"
+                                                                           " -DCMAKE_INSTALL_LOCALSTATEDIR=/var");
 
             break;
 
diff --git a/libpkgupd/compiler.hh b/libpkgupd/compiler.hh
index 70ac42a..80a1818 100644
--- a/libpkgupd/compiler.hh
+++ b/libpkgupd/compiler.hh
@@ -30,7 +30,6 @@ class compiler : public object {
     std::map<std::string, configurator> _configurators =
         {
             {"configure", configurator::AUTOCONF},
-            {"autogen.sh", configurator::AUTOGEN},
             {"CMakeLists.txt", configurator::CMAKE},
             {"meson.build", configurator::MESON},
             {"setup.py", configurator::PYSETUP},
-- 
2.30.2

