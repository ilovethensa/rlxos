id: systemd
version: 249
about: |
  Package contains programs for controlling the startup, running, and shutdown of the system

depends:
  runtime:
    - acl
    - bash
    - coreutils
    - diffutils
    - glibc
    - grep
    - py-jinja2
    - libcap
    - sed
    - gawk
    - lz4

  buildtime:
    - gcc
    - meson
    - expat
    - gperf

sources:
  - https://github.com/systemd/systemd/archive/v249/systemd-249.tar.gz

environ:
  - LANG=en_IN.UTF-8
  - PKG_CONFIG_PATH="/usr/lib/pkgconfig:/tools/lib/pkgconfig"

packages:
  - id: pkg
    dir: systemd-249

    prescript: |
      sed -i -e "s/GROUP=\"render\"/GROUP=\"video\"/" -e "s/GROUP=\"sgx\", //" rules.d/50-udev-default.rules.in


    flags:
      - id: configurator
        value: meson.build

      - id: configure
        value: 
          --sysconfdir=/etc
          -D blkid=true
          -D default-dnssec=no
          -D firstboot=false
          -D install-tests=false
          -D sysusers=false
          -D rpmmacrosdir=no
          -D pam=true
          -D userdb=true
          -D pam=true
          -D lz4=true
          -D man=false
          -D mode=release
          -D kmod-path=/usr/bin/kmod
          -D mount-path=/usr/bin/mount
          -D umount-path=/usr/bin/umount
          -D sulogin-path=/usr/bin/sulogin
    
    postscript: |
      patch ${pkgupd_pkgdir}/usr/lib/systemd/system/systemd-udevd.service < ${FILES}/systemd/run-after-rlxos-boot.patch

    postinstall: |
      systemd-machine-id-setup
      
      journalctl --update-catalog

      systemctl enable \
        getty@tty1.service \
        remote-fs.target