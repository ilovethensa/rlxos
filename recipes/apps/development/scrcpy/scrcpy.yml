id: scrcpy
version: 1.23
release: 3
about: Display and control your android device
license: Apache
depends:
  buildtime:
    - ffmpeg
    - sdl2
    - libusb
    - meson
    - appimagetool
    - android-tools
type: app
bundle: true
sources:
  - scrcpy-{{version}}.tar.gz::https://github.com/Genymobile/scrcpy/archive/v{{version}}.tar.gz
  - https://github.com/Genymobile/scrcpy/releases/download/v{{version}}/{{id}}-server-v{{version}}

build-dir: scrcpy-{{version}}
configure: >
  --buildtype=release
  -D b_lto=true
  -D b_ndebug=true
  -D prebuilt_server="../{{id}}-server-v{{version}}"

post-script: |
  cp ${pkgupd_pkgdir}/usr/share/icons/hicolor/256x256/apps/scrcpy.png ${pkgupd_pkgdir}/
  cp ${FILES_DIR}/scrcpy.desktop ${pkgupd_pkgdir}/
  install -v -D -m 755 ${FILES_DIR}/AppRun -t ${pkgupd_pkgdir}/

  mkdir -p ${pkgupd_pkgdir}/usr/lib/

  # include adb
  install -v -D -m 0755 /usr/bin/adb -t ${pkgupd_pkgdir}/usr/bin/

  rm -r ${pkgupd_pkgdir}/usr/share/{man,zsh,bash-completion}