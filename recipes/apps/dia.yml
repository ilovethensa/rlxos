id: dia
version: 0.97.3
release: 2
about: Dia is a GTK+ based diagram creation program for GNU/Linux, MacOS X, Unix, and Windows, and is released under the GPL license. ... It currently has special objects to help draw entity relationship diagrams, UML diagrams, flowcharts, network diagrams, and many other diagrams
license: GPL
tags: 
  - drawing
  - flowchat
  - uml
  - diagram

depends:
  buildtime:
    - gtk2
    - libxslt
    - docbook-xsl
    - intltool
    - python2
    - pkgupd-image
    - appimagetool

category: accessories
type: app

sources:
  - https://ftp.gnome.org/pub/gnome/sources/dia/0.97/dia-{{version}}.tar.xz

environ:
  - PYTHON=/usr/bin/python2

pre-script: |
  for file in `find -type f -name '*.py'`; do
      sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' "$file"
  done
  sed -i 's#python2\.1#python2 python2.1#' configure
  sed -i 's#freetype-config --cflags#pkg-config --cflags freetype2#' configure
  sed -i 's#freetype-config --libs#pkg-config --libs freetype2#' configure

  patch -Np1 -i ${FILES}/dia/dia.patch

autoconf-dir: true
configure: >
  --with-cairo
  --with-python

post-script: |
  cd ${pkgupd_pkgdir}
  mv usr/share/applications/dia.desktop dia.desktop
  cp usr/share/icons/hicolor/48x48/apps/dia.png dia.png

  # TODO: check better way
  mv usr/share/dia data
  mv data/ui/* data/
files:
  - path: AppRun
    perm: 0755
    content: |
      #!/bin/sh
      HERE="$(dirname "$(readlink -f "${0}")")"
      export DIA_BASE_PATH=${HERE}
      export DIA_LIB_PATH=${HERE}/usr/lib/dia:${HERE}
      export DIA_SHARE_PATH=${HERE}/data/shapes
      export DIA_XSLT_PATH=${HERE}/data/xslt
      export DIA_PYTHON_PATH=${HERE}/data/python:${HERE}/data
      export DIA_SHEET_PATH=${HERE}/data/sheets
      export LD_LIBRARY_PATH=${HERE}/usr/lib/dia:${LD_LIBRARY_PATH}
      exec ${HERE}/usr/bin/dia $@