id: qt5-webengine
version: 5.15.10
about: QtWebEngine integrates chromium's web capabilities into Qt
depends:
  runtime:
    - nodejs
    - nss
    - pciutils
    - qt
    - alsa-lib
    - pulseaudio
    - ffmpeg
    - icu
    - libwebp
    - libxslt
    - opus
    - libevent
    - kerberos-v5
    - pipewire
    - poppler
  buildtime:
    - gperf
sources:
  - https://anduin.linuxfromscratch.org/BLFS/qtwebengine/qtwebengine-{{version}}.tar.xz

script: |
  patch -Np1 -i ${FILES_DIR}/qtwebengine-5.15.10-build_fixes-1.patch
  mkdir -pv .git src/3rdparty/chromium/.git
  sed -e '/^MODULE_VERSION/s/5.*/5.15.5/' -i .qmake.conf
  find -type f -name "*.pr[io]" |
    xargs sed -i -e 's|INCLUDEPATH += |&$$QTWEBENGINE_ROOT/include |'

  sed -e '/link_pulseaudio/s/false/true/' \
    -i src/3rdparty/chromium/media/media_options.gni
  
  sed -i 's/NINJAJOBS/NINJA_JOBS/' src/core/gn_run.pro

  mkdir -p build && cd build
  qmake .. -- -system-ffmpeg -webengine-icu

  make
  make INSTALL_ROOT=${pkgupd_pkgdir} install

  find ${pkgupd_pkgdir}/ -name \*.prl \
   -exec sed -i -e '/^QMAKE_PRL_BUILD_DIR/d' {} \;
