id: qt
version: 5.15.5
about: |
  Cross-platform application framework

depends:
  runtime:
    - dbus
    - openssl
    - gdk-pixbuf
    - libepoxy
    - libmng
    - libxkbcommon
    - harfbuzz
    - xcb-util-wm
    - xcb-util-image
    - xcb-util-keysyms
    - xcb-util-renderutil
    - desktop-file-utils
    - libxcb
    - sqlite
    - fontconfig
    - which
    - nss
    - libwebp
    - python
    - alsa-lib
    - pulseaudio
    - ffmpeg
    - wayland
    - icu

build-dir: qt-everywhere-src-{{version}}
sources:
  - https://download.qt.io/archive/qt/5.15/{{version}}/single/qt-everywhere-src-{{version}}.tar.xz
script: |
  patch -Np1 -i ${FILES_DIR}/qt-everywhere-opensource-src-{{version}}-kf5-1.patch

  ./configure -prefix /usr \
    -sysconfdir /etc/xdg \
    -confirm-license -opensource \
    -dbus-linked \
    -openssl-linked \
    -system-harfbuzz \
    -system-sqlite \
    -nomake examples \
    -no-rpath \
    -syslog \
    -journald \
    -skip qtwebengine

  make

  make install INSTALL_ROOT=${pkgupd_pkgdir}

  find ${pkgupd_pkgdir}/ -name \*.prl \
    -exec sed -i -e "/^QMAKE_PRL_BUILD_DIR/d" {} \;

  install -v -D -m 644 qttools/src/assistant/assistant/images/assistant-128.png \
    $pkgupd_pkgdir/usr/share/pixmaps/assistant-qt5.png
  
  install -v -D -m 644 qttools/src/designer/src/designer/images/designer.png \
    $pkgupd_pkgdir/usr/share/pixmaps/designer-qt5.png
  
  install -v -Dm644 qttools/src/linguist/linguist/images/icons/linguist-128-32.png \
              ${pkgupd_pkgdir}/usr/share/pixmaps/linguist-qt5.png
  
  install -v -Dm644 qttools/src/qdbus/qdbusviewer/images/qdbusviewer-128.png \
              ${pkgupd_pkgdir}/usr/share/pixmaps/qdbusviewer-qt5.png

  install -v -D ${FILES}/qt/*.desktop -t ${pkgupd_pkgdir}/usr/share/applications/