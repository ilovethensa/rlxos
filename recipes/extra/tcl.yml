id: tcl
version: 8.6.12
about: Powerful, easy-to-learn dynamic programming language
depends:
  runtime:
    - zlib
sources:
  - https://downloads.sourceforge.net/sourceforge/tcl/tcl{{version}}-src.tar.gz

configure: >
  --enable-threads
  --enable-64bit

install: INSTALL_ROOT=${pkgupd_pkgdir} install-private-headers install
post-script: |
  ln -sf tclsh${pkgver%.*} "${pkgupd_pkgdir}/usr/bin/tclsh"
  ln -sf libtcl${pkgver%.*}.so "${pkgupd_pkgdir}/usr/lib/libtcl.so"
  install -Dm644 ../license.terms "${pkgupd_pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
  install -Dm644 tcl.m4 -t "$pkgdir"/usr/share/aclocal
  chmod 644 "$pkgdir/usr/lib/libtclstub8.6.a"

  # remove buildroot traces
  _tclver=8.6
  sed -e "s#${pkgupd_srcdir}/tcl{{version}}/unix#/usr/lib#" \
      -e "s#${pkgupd_srcdir}/tcl{{version}}#/usr/include#" \
      -e "s#'{/usr/lib} '#'/usr/lib/tcl$_tclver'#" \
      -i "${pkgupd_pkgdir}/usr/lib/tclConfig.sh"

  tdbcver=tdbc1.1.3
  sed -e "s#${pkgupd_srcdir}/tcl{{version}}/unix/pkgs/$tdbcver#/usr/lib/$tdbcver#" \
      -e "s#${pkgupd_srcdir}/tcl{{version}}/pkgs/$tdbcver/generic#/usr/include#" \
      -e "s#${pkgupd_srcdir}/tcl{{version}}/pkgs/$tdbcver/library#/usr/lib/tcl${pkgver%.*}#" \
      -e "s#${pkgupd_srcdir}/tcl{{version}}/pkgs/$tdbcver#/usr/include#" \
      -i "${pkgupd_pkgdir}/usr/lib/$tdbcver/tdbcConfig.sh"

  itclver=itcl4.2.2
  sed -e "s#${pkgupd_srcdir}/tcl{{version}}/unix/pkgs/$itclver#/usr/lib/$itclver#" \
      -e "s#${pkgupd_srcdir}/tcl{{version}}/pkgs/$itclver/generic#/usr/include#" \
      -e "s#${pkgupd_srcdir}/tcl{{version}}/pkgs/$itclver#/usr/include#" \
      -i "${pkgupd_pkgdir}/usr/lib/$itclver/itclConfig.sh"