id: postfix
version: 3.7.2
about: Postfix package contains a Mail Transport Agent
depends:
  runtime:
    - berkeley-db
    - cyrus-sasl
    - icu
    - pcre2
    - libldap
  buildtime:
    - openldap
groups:
  - id: 32
    name: postfix

  - id: 33
    name: postdrop
users:
  - id: 32
    name: postfix
    about: Postfix Daemon User
    dir: /var/spool/postfix
    group: postfix
    shell: /bin/false

sources:
  - https://ghostarchive.org/postfix/postfix-release/official/postfix-{{version}}.tar.gz
build-dir: postfix-{{version}}
script: |
  sed -i 's/.\x08//g' README_FILES/*
  unset DEBUG
  groupadd -g 32 postfix
  groupadd -g 33 postdrop 
  useradd -c "Postfix Daemon User" -d /var/spool/postfix -g postfix -s /bin/false -u 32 postfix &&
  chown -v postfix:postfix /var/mail
  make CCARGS='-DNO_NIS \
               -DUSE_TLS -I/usr/include/openssl/ \
               -DUSE_SASL_AUTH -DUSE_CYRUS_SASL -I/usr/include/sasl \
               -DHAS_LDAP \
               -DHAS_SQLITE' \
      AUXLIBS="-lssl -lcrypto -lsasl2 -lldap -lsqlite3 -llber -lpthread -lz -lm" makefiles

  make
  sh postfix-install -non-interactive \
        daemon_directory=/usr/lib/postfix \
        manpage_directory=/usr/share/man \
        html_directory=/usr/share/doc/postfix-{{version}}/html \
        readme_directory=/usr/share/doc/postfix-{{version}}/readme

  install -v -D -m 644 LICENSE -t ${pkgupd_pkgdir}/usr/share/doc/{{id}}/
  install -vDm 644 ${FILES_DIR}/{{id}}.service -t "$pkgupd_pkgdir/usr/lib/systemd/system/"
  install -vDm 644 ${FILES_DIR}/{{id}}.tmpfiles "$pkgupd_pkgdir/usr/lib/tmpfiles.d/{{id}}.conf"
