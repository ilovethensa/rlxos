id: fcron
version: 3.2.1
about: A periodical command scheduler which aims at replacing Vixie Cron
sources:
  - http://fcron.free.fr/archives/fcron-{{version}}.src.tar.gz

depends:
  runtime:
    - postfix
    - pam
    - systemd
    - vim
groups:
  - id: 22
    name: fcron

users:
  - id: 22
    name: fcron
    about: Fcron user
    group: fcron
    shell: /bin/false
    dir: /dev/null

backup:
  - etc/fcron.conf
  - etc/fcron.allow
  - etc/fcron.deny
build-dir: fcron-{{version}}
pre-script: |
  find doc -type f -exec sed -i 's:/usr/local::g' {} \;
  groupadd -g 22 fcron &&
  useradd -d /dev/null -c "Fcron User" -g fcron -s /bin/false -u 22 fcron

configure: >
  --with-piddir=/run
  --with-boot-install=no
  --with-answer-all=no
  --with-systemdsystemunitdir=/usr/lib/systemd/system
  --with-editor=/usr/bin/vim
  --with-sendmail=/usr/bin/sendmail

post-script: |
  install -Dm644 files/fcron.pam ${pkgupd_pkgdir}/etc/pam.d/fcron
  install -Dm644 files/fcrontab.pam ${pkgupd_pkgdir}/etc/pam.d/fcrontab
  install -v -D -m 755 ${FILES_DIR}/run-parts.sh ${pkgupd_pkgdir}/usr/bin/run-parts
  install -d -m755 "$pkgupd_pkgdir/etc/cron.daily"
  install -d -m755 "$pkgupd_pkgdir/etc/cron.hourly"
  install -d -m755 "$pkgupd_pkgdir/etc/cron.monthly"
  install -d -m755 "$pkgupd_pkgdir/etc/cron.weekly"

install-script: |
  fcrontab -z -u systab &>/dev/null

