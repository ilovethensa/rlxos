id: lm-sensors
version: 3.6.0
about: collection of user space tools for general SMBus access and hardware monitoring
depends:
  runtime:
    - perl
    - rrdtool
sources:
  - https://github.com/{{id}}/{{id}}/archive/refs/tags/V3-6-0.tar.gz

pre-script: |
  sed -i 's|/etc/sysconfig|/etc/conf.d|' prog/{detect/sensors-detect,init/{sensord,lm_sensors}.service}
  sed -i 's/EnvironmentFile=/EnvironmentFile=-/' prog/init/lm_sensors.service

script: |
  make PREFIX=/usr

  make PROG_EXTRA=sensord BUILD_STATIC_LIB=0 \
    PREFIX=/usr SBINDIR=/usr/bin MANDIR=/usr/share/man \
    DESTDIR=${pkgupd_pkgdir} install

  install -v -D -m 0755 ${FILES_DIR}/healthd ${pkgupd_pkgdir}/usr/bin/healthd
  install -v -D -m 0644 ${FILES_DIR}/healthd.conf ${pkgupd_pkgdir}/etc/healthd.conf
  install -v -D -m 0644 ${FILES_DIR}/sensord.conf ${pkgupd_pkgdir}/etc/conf.d/sensord
  install -v -D -m 0644 ${FILES_DIR}/healthd.service ${pkgupd_pkgdir}/usr/lib/systemd/system/healthd.service
  install -v -D -m 0644 prog/init/*.service ${pkgupd_pkgdir}/usr/lib/systemd/system/