id: avahi
version: 0.8
about: |
  A system which facilitates service discovery on a local network

depends:
  runtime:
    - glib
    - gtk2
    - gtk
    - libdaemon
    - libglade
  buidtime:
    - gobject-introspection
  
sources:
  - https://github.com/lathiat/avahi/releases/download/v0.8/avahi-0.8.tar.gz
  - https://www.linuxfromscratch.org/patches/blfs/svn/avahi-0.8-ipv6_race_condition_fix-1.patch

groups:
  - id: 84
    name: avahi

users:
  - id: 84
    name: avahi
    group: 84
    about: Avahi Daemon Owner
    dir: /var/run/avahi-daemon
    shell: /bin/false

packages:
  - id: pkg
    dir: avahi-0.8
    prescript: |
      patch -Np1 -i ../avahi-0.8-ipv6_race_condition_fix-1.patch
      sed -i "426a if (events & AVAHI_WATCH_HUP) { \
      client_free(c); \
      return; \
      }" avahi-daemon/simple-protocol.c
    
    flags:
      - id: configure
        value: >
          --disable-static
          --disable-libevent
          --disable-mono
          --disable-monodoc
          --disable-python
          --disable-qt3
          --disable-qt4
          --disable-qt5
          --enable-core-docs
          --with-distro=none