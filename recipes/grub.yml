id: grub
version: 2.06
about: |
  GRand Unified Bootloader

depends:
  runtime:
    - gettext
    - bash
    - xz
    - efibootmgr
    - freetype
    - libisoburn
    - dosfstools

  buildtime:
    - python
    - flex
    - m4
    - bison

environ:
  - PYTHON=python3
  - CFLAGS=""

packages:
  - id: legacy
    dir: grub-2.06
    sources:
      - http://ftp.gnu.org/gnu/grub/grub-2.06.tar.xz

    flags:
      - id: configurator
        value: configure

      - id: configure
        value: >
          --disable-werror
          --disable-efiemu
          --with-platform=pc
          --target=i386
          --disable-nls
          --sysconfdir=/etc
          CFLAGS="-Os"
          CXXFLAGS="${CFLAGS}"
        
  - id: pkg
    dir: grub-2.06
    sources:
      - http://ftp.gnu.org/gnu/grub/grub-2.06.tar.xz

    prescript: |
      patch util/grub-mkconfig.in < ${FILES}/grub/0001-RLXOS-CONFIG-PATCH-TO-SUPPORT-OVERLAY-FS.patch
      patch util/grub.d/10_linux.in < ${FILES}/grub/0002-RLXOS-SYSTEM-IMAGE-SEARCH-SUPPORT.patch

    flags:
      - id: configurator
        value: configure
        
      - id: configure
        value: >
          --disable-werror
          --disable-efiemu
          --enable-grub-mkfont
          --with-platform=efi
          --target=x86_64
          --sysconfdir=/etc
          --with-bootdir=/boot/
          CFLAGS="-Os"
          CXXFLAGS="${CFLAGS}"

    postscript: |
      install -v -D -m 0644 ${FILES}/grub/grub.default ${pkgupd_pkgdir}/etc/default/grub
      install -v -D -m 0755 ${FILES}/grub/update-grub.sh ${pkgupd_pkgdir}/usr/bin/update-grub
      install -v -D  ${FILES}/grub/unicode.pf2 ${pkgupd_pkgdir}/usr/share/grub/unicode.pf2