id: dkms
version: 3.0.6
about: Dynamic Kernel Modules System
depends:
  runtime:
    - bash
    - coreutils
    - gawk
    - gcc
    - kmod
    - make
    - patch
    - sed
sources:
  - dkms-{{version}}.tar.gz::https://github.com/dell/dkms/archive/refs/tags/v{{version}}.tar.gz

build-dir: dkms-{{version}}

script: |
  for i in dkms{.in,.8.in,_framework.conf,.bash-completion,_common.postinst}; do
    sed -ri 's,/lib/modules,/boot/modules,g' "$i"
  done

  make DESTDIR=${pkgupd_pkgdir}   \
    SBIN=${pkgupd_pkgdir}/usr/bin \
    BASHDIR=${pkgupd_pkgdir}/usr/share/bash-completion/completions \
    KCONF=${pkgupd_srcdir}/trash \
    LIBDIR=${pkgupd_srcdir}/trash \
    install
