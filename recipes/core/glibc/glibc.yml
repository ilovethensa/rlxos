id: glibc
version: 2.33
about: GNU C Library


depends:
  runtime:
    - filesystem

  buildtime:
    - kernel-headers

packages:
  - id: pkg
    dir: glibc-2.33
    sources:
      - https://ftp.gnu.org/gnu/glibc/glibc-2.33.tar.xz

    skipstrip:
    - lib.*/ld-.*\.so$
    - lib.*/libc-.*\.so$
    - lib.*/libpthread-.*\.so$
    - lib.*/libthread_db-.*\.so$

    prescript: |
      patch -Np1 -i ${FILES_DIR}/glibc-2.33-fhs-1.patch
      sed -e "402a\      *result = local->data.services[database_index];" -i nss/nss_database.c
      sed "s/amx_/amx-/" -i sysdeps/x86/tst-cpu-features-supports.c

    environ:
      - M4=m4

    flags:
      - id: configure
        value: >
          --libexecdir=/usr/lib
          --disable-werror
          --enable-kernel=3.2
          --enable-stack-protector=strong
          --with-headers=/usr/include
          libc_cv_slibdir=/usr/lib

    postscript: |
      sed "/RTLDLIST=/s@/usr@@g" -i ${pkgupd_pkgdir}/usr/bin/ldd