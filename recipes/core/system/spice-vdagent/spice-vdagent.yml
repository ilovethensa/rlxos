id: spice-vdagent
version: 0.22.1
release: 2
about: Spice agent for linux guests
depends:
  runtime:
    - alsa-lib
    - dbus
    - glib
    - gtk
    - libdrm
    - libpciaccess
    - libXfixes
    - libXinerama
    - libXrandr
    - systemd
  buildtime:
    - spice-protocol
sources:
  - https://www.spice-space.org/download/releases/{{id}}-{{version}}.tar.bz2

pre-script: |
  sed -i 's|/etc/sysconfig/spice-vdagentd|/etc/conf.d/spice-vdagentd|
          s|/usr/sbin/spice-vdagentd|/usr/bin/spice-vdagentd|' data/spice-vdagentd.service
  sed -i 's|/etc/sysconfig/spice-vdagentd|/etc/conf.d/spice-vdagentd|' data/spice-vdagentd.1.in

autoconf-dir: true
configure: >
  --with-session-info=systemd
  --with-init-script=systemd

post-script: |
  [ -d ${pkgupd_pkgdir} ] && rm -r ${pkgupd_pkgdir}/var
  install -dm 755 ${pkgupd_pkgdir}/etc/conf.d/
  echo 'SPICE_VDAGENTD_EXTRA_ARGS=""' > "$pkgupd_pkgdir/etc/conf.d/spice-vdagentd"

  install -v -D -m 0755 -t ${pkgupd_pkgdir}/etc/modules-load.d/ ${FILES_DIR}/10-uinput.conf
