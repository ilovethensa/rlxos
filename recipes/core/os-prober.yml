id: os-prober
version: 1.79
about: utility to detect installed OSes
depends:
  runtime:
    - bash
sources:
  - http://http.debian.net/debian/pool/main/o/os-prober/os-prober_1.79.tar.xz
packages:
  - id: pkg
    dir: os-prober
    script: |
      sed -i -e "s:/lib/ld\*\.so\*:/lib*/ld*.so*:g" os-probes/mounted/common/90linux-distro
      rm -f Makefile

      make newns

      install -v -D -m 0755 os-prober linux-boot-prober -t ${pkgupd_pkgdir}/usr/bin/
      install -v -D -m 0755 newns -t ${pkgupd_pkgdir}/usr/lib/os-prober
      install -v -D -m 0755 common.sh -t ${pkgupd_pkgdir}/usr/share/os-prober

      for dir in os-probes os-probes/mounted os-probes/init linux-boot-probes linux-boot-probes/mounted; do
        install -dm 755 "${pkgupd_pkgdir}/usr/lib/${dir}"
        install -m 755 -t "${pkgupd_pkgdir}/usr/lib/${dir}" "${dir}"/common/*
        [[ -d "${dir}"/x86 ]] && cp -r "${dir}"/x86/* "${pkgupd_pkgdir}/usr/lib/${dir}"
      done

      install -Dm 755 os-probes/mounted/powerpc/20macosx "${pkgupd_pkgdir}"/usr/lib/os-probes/mounted/20macosx
      install -dm 755 "${pkgupd_pkgdir}"/var/lib/os-prober