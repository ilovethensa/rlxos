id: avahi
version: 0.8
release: 1
about: |
  A system which facilitates service discovery on a local network

depends:
  runtime:
    - expat
    - libdaemon
    - glib
    - libcap
    - gdbm
    - dbus
  buildtime:
    - gobject-introspection
    - gtk
    - qt5
    - py-dbus
    - py-gobject
    - libevent
    - graphviz
  
sources:
  - https://github.com/lathiat/avahi/releases/download/v{{version}}/avahi-{{version}}.tar.gz

groups:
  - id: 84
    name: avahi

users:
  - id: 84
    name: avahi
    group: 84
    about: Avahi Daemon Owner
    dir: /var/run/avahi-daemon
    shell: /bin/false

configure: >
  with_dbus_sys=/usr/share/dbus-1/system.d
  --enable-compat-libdns_sd
  --with-distro=none
  --with-avahi-priv-access-group=network
  --with-autoipd-user=avahi
  --with-autoipd-group=avahi
  --with-systemdsystemunitdir=/usr/lib/systemd/system

post-script: |
  ln -s avahi-compat-libdns_sd/dns_sd.h "$pkgupd_pkgdir/usr/include/dns_sd.h"