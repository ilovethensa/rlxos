id: gnome-shell-extension-nightmode
version: 51
release: 1
about: Support for night mode and theme switching
depends:
  runtime:
    - glib
  buildtime:
    - unzip
sources:
  - nightmode-{{version}}::https://extensions.gnome.org/extension-data/nightthemeswitcherromainvigier.fr.v{{version}}.shell-extension.zip

script: |
  mkdir -p ${pkgupd_pkgdir}/usr/share/gnome-shell/extensions/nightthemeswitcher@romainvigier.fr
  unzip nightmode-{{version}} -d ${pkgupd_pkgdir}/usr/share/gnome-shell/extensions/nightthemeswitcher@romainvigier.fr
  
  cd ${pkgupd_pkgdir}/usr/share/gnome-shell/extensions/nightthemeswitcher@romainvigier.fr

  patch schemas/org.gnome.shell.extensions.nightthemeswitcher.gschema.xml < ${FILES}/{{id}}/system-defaults.patch
  patch schemas/org.gnome.shell.extensions.nightthemeswitcher.v0.gschema.xml < ${FILES}/{{id}}/system-defaults-1.patch
  
  glib-compile-schemas schemas

  for i in $(find . -type f) ; do
    chmod 644 ${i}
  done

  for i in $(find . -type d) ; do
    chmod 755 ${i}
  done