id: linux
version: 5.12.10
about: |
  Linux kernel, modules and headers

sources:
  - https://www.kernel.org/pub/linux/kernel/v5.x/linux-5.12.10.tar.xz

packages:
  - id: pkg
    dir: linux-5.12.10
    script: |
      make mrproper

      cp ${FILES}/kernel.config ./.config

      mkdir -p ${pkgupd_pkgdir}/{boot,lib}
      ln -sv ../lib/modules ${pkgupd_pkgdir}/boot/modules

      make olddefconfig

      make bzImage modules
      make INSTALL_MOD_PATH=${pkgupd_pkgdir} modules_install

      cp ./.config ${FILES}/kernel.config

      cp arch/x86/boot/bzImage ${pkgupd_pkgdir}/boot/vmlinuz-{{version}}-rlxos      
      
      rm ${pkgupd_pkgdir}/boot/modules/5.12.10-rlxos/{build,source}
      rm ${pkgupd_pkgdir}/boot/modules
      mv ${pkgupd_pkgdir}/{lib,boot}/modules
      rmdir ${pkgupd_pkgdir}/lib
