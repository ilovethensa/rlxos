id: linux-zen
version: 5.18.1-zen1
about: |
  Linux Zen kernel

depends:
  buildtime:
    - gcc
    - bc
    - perl
    - cpio
    - tar
    - xz
sources:
  - linux-{{version}}.tar.gz::https://github.com/zen-kernel/zen-kernel/archive/refs/tags/v{{version}}.tar.gz

strip: false
build-dir: zen-kernel-{{version}}
script: |
  make mrproper

  cp ${FILES}/linux-zen/5.18.1-zen1.conf ./.config

  mkdir -p ${pkgupd_pkgdir}/{boot,lib}
  ln -sv ../lib/modules ${pkgupd_pkgdir}/boot/modules

  make olddefconfig

  make bzImage modules
  make INSTALL_MOD_PATH=${pkgupd_pkgdir} modules_install

  cp ./.config ${FILES}/linux-zen/5.18.1-zen1.config

  cp arch/x86/boot/bzImage ${pkgupd_pkgdir}/boot/vmlinuz-{{version}}
  
  rm ${pkgupd_pkgdir}/boot/modules/{{version}}/{build,source}
  rm ${pkgupd_pkgdir}/boot/modules
  mv ${pkgupd_pkgdir}/{lib,boot}/modules
  rmdir ${pkgupd_pkgdir}/lib
