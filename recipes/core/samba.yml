id: samba
version: 4.15.3
release: 1
about: |
  Package provides file and print services to SMB/CIFS clients and Windows networking to Linux clients

depends:
  runtime:
    - gnutls
    - jansson
    - libtirpc
    - lmdb
    - rpcsvc-proto
    - fuse
    - gpgme
    - libtasn1
    - libxslt
    - pam
    - perl-parse-yapp
    - cups

sources:
  - https://www.samba.org/ftp/samba/stable/samba-{{version}}.tar.gz

script: |
  python3 -m venv pyenv
  ./pyenv/bin/pip3 install cryptography pyasn1 iso8601
  PYTHON=$PWD/pyenv/bin/python3 \
  CPPFLAGS="-I/usr/lib/tirpc" \
    LDFLAGS="-ltirpc" \
  ./configure --prefix=/usr \
      --sysconfdir=/etc \
      --sbindir=/usr/bin \
      --libdir=/usr/lib \
      --libexecdir=/usr/lib/samba \
      --localstatedir=/var \
      --with-configdir=/etc/samba \
      --with-lockdir=/var/cache/samba \
      --with-sockets-dir=/run/samba \
      --with-piddir=/run \
      --with-pammodulesdir=/usr/lib/security \
      --enable-fhs \
      --without-ad-dc \
      --enable-selftest

  make
  make DESTDIR=${pkgupd_pkgdir} install

post-script: |
  install -vdm 755 ${pkgupd_pkgdir}/usr/lib/cups/backend
  ln -sf -v /usr/bin/smbspool ${pkgupd_pkgdir}/usr/lib/cups/backend/smb
