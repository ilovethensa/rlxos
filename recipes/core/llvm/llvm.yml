id: llvm
version: 12.0.1
about: |
  A collection of modular and reusable compiler and toolchain technologies

depends:
  buildtime:
    - cmake

sources:
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-12.0.1/llvm-12.0.1.src.tar.xz
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-12.0.1/clang-12.0.1.src.tar.xz
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-12.0.1/compiler-rt-12.0.1.src.tar.xz

build-dir: llvm-12.0.1.src
pre-script: |
  ls ../
  mv ../clang-12.0.1.src tools/clang
  mv ../compiler-rt-12.0.1.src projects/compiler-rt

  grep -rl "#!.*python" | xargs sed -i "1s/python$/python3/"

configure: >
  -DCMAKE_LIBEXECDIR=/usr/lib
  -DLLVM_ENABLE_FFI=ON
  -DCMAKE_BUILD_TYPE=Release
  -DLLVM_BUILD_LLVM_DYLIB=ON
  -DLLVM_LINK_LLVM_DYLIB=ON
  -DLLVM_ENABLE_RTTI=ON
  -DLLVM_TARGETS_TO_BUILD="X86;AMDGPU;BPF"
  -DLLVM_BUILD_TESTS=ON
  -DLLVM_BINUTILS_INCDIR=/usr/include
  -Wno-dev -G Ninja

split:
  - into: libllvm
    about: llvm runtime library
    files:
      - usr/lib/libLTO.so.12
      - usr/lib/libLLVM-12.0.1.so
      - usr/lib/libLLVM-12.so
      - usr/lib/libRemarks.so
      - usr/lib/libLTO.so
      - usr/lib/LLVMgold.so
      - usr/lib/libLLVM.so
      - usr/lib/libclang.so.12
      - usr/lib/libclang.so
      - usr/lib/libclang-cpp.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.ubsan_minimal-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.hwasan-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.scudo_minimal-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.asan-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.scudo-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.memprof-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.dyndd-x86_64.so
      - usr/lib/clang/12.0.1/lib/linux/libclang_rt.ubsan_standalone-x86_64.so
      - usr/lib/libclang-cpp.so.12
      - usr/lib/libRemarks.so.12
