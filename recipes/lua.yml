id: lua
version: 5.3.5
about: |
  A powerful light-weight programming language designed for extending applications

sources:
  - https://www.lua.org/ftp/lua-5.3.5.tar.gz
  - https://www.linuxfromscratch.org/patches/blfs/9.1/lua-5.3.5-shared_library-1.patch

packages:
  - id: pkg
    dir: lua-5.3.5
    plugin: script
    script: |
      patch -Np1 -i ../lua-5.3.5-shared_library-1.patch
      sed -i '/#define LUA_ROOT/s:/usr/local/:/usr/:' src/luaconf.h
      make MYCFLAGS="-DLUA_COMPAT_5_2 -DLUA_COMPAT_5_1" linux
      make INSTALL_TOP=${pkgupd_pkgdir}/usr \
        INSTALL_DATA="cp -d" \
        INSTALL_MAN=${pkgupd_pkgdir}/usr/share/man/man1 \
        TO_LIB="liblua.so liblua.so.5.3 liblua.so.5.3.4" \
        install

      install -v -D -m 644 ${FILES}/lua/lua.pc -t ${pkgupd_pkgdir}/usr/lib/pkgconfig/
