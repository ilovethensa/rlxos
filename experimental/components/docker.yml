id: docker
version: 20.10.7
about: Pack, ship and run any application as a lightweight container
sources:
- https://github.com/moby/moby/archive/v20.10.7/moby-20.10.7.tar.gz
- https://github.com/docker/cli/archive/v20.10.7/cli-20.10.7.tar.gz
- libnetwork-0.3.tar.gz::https://github.com/moby/libnetwork/archive/refs/heads/master.tar.gz
build-dir: .
depends:
  buildtime:
  - go
  runtime:
  - containerd
  - runc
  - lvm2
  - btrfs-progs
  - cgroupfs-mount
script: "export GOPATH=${pkgupd_srcdir}\nmkdir -p src/github.com/docker\ncd src/github.com/docker\n\
  ln -s ${pkgupd_srcdir}/cli-20.10.7 cli\ncd cli\nmake VERSION=20.10.7 dynbinary\n\
  \ncd ../\nln -s ${pkgupd_srcdir}/moby-20.10.7 docker\ncd docker\nVERSION=20.10.7\
  \ hack/make.sh dynbinary\nls -al bundles/dynbinary-daemon/\ncd ../\nln -s ${pkgupd_srcdir}/libnetwork-master\
  \ libnetwork\n#ls -al libnetwork/\t\ncd libnetwork/cmd/proxy\nGOROOT=/usr/lib/go\
  \ go build -o ${pkgupd_pkgdir}/usr/bin/docker-proxy\n\ncd ${pkgupd_srcdir}\n\ninstall\
  \ -D -m 0755 cli-20.10.7/build/docker ${pkgupd_pkgdir}/usr/bin/docker\ninstall -D\
  \ -m 0755 moby-20.10.7/bundles/dynbinary-daemon/dockerd-20.10.7 \\\n  ${pkgupd_pkgdir}/usr/bin/dockerd\n\
  \  \n  #  for M in 1 5 8 ; do\n  #install -d -m 0755 ${pkgupd_pkgdir}/usr/share/man/man${M}\n\
  \  #install -m 0644 ${pkgupd_srcdir}/man${M}/* ${pkgupd_pkgdir}/usr/share/man/man${M}\n\
  \  #done\n\nln -s containerd ${pkgupd_pkgdir}/usr/bin/docker-containerd\nln -s containerd-shim\
  \ ${pkgupd_pkgdir}/usr/bin/docker-containerd-shim\nln -s ctr ${pkgupd_pkgdir}/usr/bin/docker-containerd-ctr\n\
  ln -s runc ${pkgupd_pkgdir}/usr/bin/docker-runc\n\ninstall -D -m 0755 moby-20.10.7/contrib/check-config.sh\
  \ \\\n  ${pkgupd_pkgdir}/usr/share/docker/check-config.sh\n\ninstall -D -m 0755\
  \ moby-20.10.7/contrib/init/systemd/docker.{service,socket} \\\n  -t ${pkgupd_pkgdir}/usr/lib/systemd/system/\n\
  \ninstall -D -m 0644 moby-20.10.7/contrib/udev/80-docker.rules \\\n  ${pkgupd_pkgdir}/usr/lib/udev/rules.d/80-docker.rules\n"
groups:
- id: 112
  name: docker
environ:
- GO111MODULE=auto
- DOCKER_GITCOMMIT=b0f5bc3
- DOCKER_BUILDTAGS='seccomp'
- DISABLE_WARN_OUTSIDE_CONTAINER=1
